<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fútbol Pong Retro</title>
<style>
  body {
    background: black;
    color: white;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    overflow: hidden;
  }
  canvas {
    background: black;
    display: block;
    margin-top: 10px;
    border: 4px solid white;
  }
  #marcador {
    font-size: 24px;
    margin-top: 10px;
  }
  #tiempo {
    font-size: 18px;
    margin-top: 5px;
  }
  .controles {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 5px;
    position: fixed;
    bottom: 0;
  }
  .lado {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  button {
    background: white;
    color: black;
    border: none;
    padding: 20px;
    font-size: 18px;
    border-radius: 8px;
    opacity: 0.7;
  }
</style>
</head>
<body>

<div id="marcador">0 - 0</div>
<div id="tiempo">Tiempo: 60</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<div class="controles">
  <div class="lado">
    <button id="p1up">▲</button>
    <button id="p1down">▼</button>
  </div>
  <div class="lado">
    <button id="p2up">▲</button>
    <button id="p2down">▼</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let jugador1Y = canvas.height / 2 - 40;
let jugador2Y = canvas.height / 2 - 40;
const paletaAltura = 80, paletaAncho = 10;
const velocidadPaleta = 12;

let keysPressed = {};

let pelotaX = canvas.width / 2, pelotaY = canvas.height / 2;
let pelotaRadio = 5;
let velPelotaX = 4, velPelotaY = 3;

let score1 = 0, score2 = 0;
let tiempo = 60;
let intervaloTiempo;

// Botones táctiles
const p1up = document.getElementById("p1up");
const p1down = document.getElementById("p1down");
const p2up = document.getElementById("p2up");
const p2down = document.getElementById("p2down");

function setButtonHold(btn, key) {
  btn.addEventListener("touchstart", e => { e.preventDefault(); keysPressed[key] = true; });
  btn.addEventListener("touchend", e => { e.preventDefault(); keysPressed[key] = false; });
}

setButtonHold(p1up, "w");
setButtonHold(p1down, "s");
setButtonHold(p2up, "ArrowUp");
setButtonHold(p2down, "ArrowDown");

function moverPaletas() {
  if (keysPressed["w"]) jugador1Y -= velocidadPaleta;
  if (keysPressed["s"]) jugador1Y += velocidadPaleta;
  if (keysPressed["ArrowUp"]) jugador2Y -= velocidadPaleta;
  if (keysPressed["ArrowDown"]) jugador2Y += velocidadPaleta;

  jugador1Y = Math.max(0, Math.min(canvas.height - paletaAltura, jugador1Y));
  jugador2Y = Math.max(0, Math.min(canvas.height - paletaAltura, jugador2Y));
}

function dibujarCampo() {
  ctx.strokeStyle = "white";
  ctx.setLineDash([]);
  ctx.strokeRect(0, 0, canvas.width, canvas.height);

  ctx.beginPath();
  ctx.setLineDash([10, 10]);
  ctx.moveTo(canvas.width / 2, 0);
  ctx.lineTo(canvas.width / 2, canvas.height);
  ctx.stroke();
}

function dibujarPaletas() {
  ctx.fillStyle = "white";
  ctx.fillRect(20, jugador1Y, paletaAncho, paletaAltura);
  ctx.fillRect(canvas.width - 30, jugador2Y, paletaAncho, paletaAltura);
}

function dibujarPelota() {
  ctx.beginPath();
  ctx.arc(pelotaX, pelotaY, pelotaRadio, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();
  ctx.closePath();
}

function moverPelota() {
  pelotaX += velPelotaX;
  pelotaY += velPelotaY;

  if (pelotaY - pelotaRadio < 0 || pelotaY + pelotaRadio > canvas.height) {
    velPelotaY *= -1;
  }

  if (
    pelotaX - pelotaRadio < 30 &&
    pelotaY > jugador1Y &&
    pelotaY < jugador1Y + paletaAltura
  ) {
    velPelotaX *= -1;
  }
  if (
    pelotaX + pelotaRadio > canvas.width - 30 &&
    pelotaY > jugador2Y &&
    pelotaY < jugador2Y + paletaAltura
  ) {
    velPelotaX *= -1;
  }

  if (pelotaX - pelotaRadio < 0) {
    score2++;
    reiniciarPelota();
  }
  if (pelotaX + pelotaRadio > canvas.width) {
    score1++;
    reiniciarPelota();
  }
}

function reiniciarPelota() {
  pelotaX = canvas.width / 2;
  pelotaY = canvas.height / 2;
  velPelotaX *= -1;
  velPelotaY = 3 * (Math.random() > 0.5 ? 1 : -1);
}

function dibujarMarcador() {
  document.getElementById("marcador").textContent = `${score1} - ${score2}`;
}

function dibujarTiempo() {
  document.getElementById("tiempo").textContent = `Tiempo: ${tiempo}`;
}

function iniciarTiempo() {
  intervaloTiempo = setInterval(() => {
    tiempo--;
    dibujarTiempo();
    if (tiempo <= 0) {
      clearInterval(intervaloTiempo);
      alert(`Fin del juego! Marcador final: ${score1} - ${score2}`);
      document.location.reload();
    }
  }, 1000);
}

function dibujar() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  moverPaletas();
  dibujarCampo();
  dibujarPaletas();
  dibujarPelota();
  moverPelota();
  dibujarMarcador();
  requestAnimationFrame(dibujar);
}

iniciarTiempo();
dibujar();
</script>

</body>
</html>
